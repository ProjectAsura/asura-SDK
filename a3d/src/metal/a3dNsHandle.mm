//-----------------------------------------------------------------------------
// File : a3dNsHandle.mm
// Desc : NSObject Holder.
// Copyright(c) Project Asura. All right reserved.
//-----------------------------------------------------------------------------

//-----------------------------------------------------------------------------
// Includes
//-----------------------------------------------------------------------------
#include <a3dNsHandle.h>
#import  <CoreFoundation/CFBase.h>


namespace a3d {

///////////////////////////////////////////////////////////////////////////////
// NsHandle class
///////////////////////////////////////////////////////////////////////////////

//-----------------------------------------------------------------------------
//      コンストラクタです.
//-----------------------------------------------------------------------------
NsHandle::NSHandle()
{ /* DO_NOTHING */ }

//-----------------------------------------------------------------------------
//      デストラクタです.
//-----------------------------------------------------------------------------
NsHandle::~NsHandle()
{ /* DO_NOTHING */ }

//-----------------------------------------------------------------------------
//      参照カウントを増やします.
//-----------------------------------------------------------------------------
void NsHandle::AddRef()
{
    if (m_Ptr)
    { CFRetain(m_Ptr); }
}

//-----------------------------------------------------------------------------
//      参照カウントを減らします.
//-----------------------------------------------------------------------------
void NsHandle::Release()
{
    if (m_Ptr)
    {
        auto count = CFGetRetainCount(m_Ptr);
        CFRelease(m_Ptr);
        if (count == 1)
        { m_Ptr = nullptr; }
    }
}

//-----------------------------------------------------------------------------
//      参照カウントを取得します.
//-----------------------------------------------------------------------------
int NsHandle::GetRefCount()
{
    if (m_Ptr)
    { return CFGetRetainCount(m_Ptr); }

    return 0;
}

//-----------------------------------------------------------------------------
//      オブジェクトを設定します.
//-----------------------------------------------------------------------------
void NsHandle::SetPtr(const void* value)
{
    if (m_Ptr)
    {
         CFRelease(m_Ptr);
         m_Ptr = nullptr;
    }

    m_Ptr = value;
}

//-----------------------------------------------------------------------------
//      オブジェクトを取得します.
//-----------------------------------------------------------------------------
const void* NsHandle::GetPtr() const
{ return m_Ptr; }


} // namespace a3d